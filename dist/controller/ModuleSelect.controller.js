sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/m/MessageBox"],function(e,t,r,o){"use strict";return e.extend("com.swcc.Template.controller.ModuleSelect",{onInit:function(){this.oRouter=this.getRouter();this.getRouter().getRoute("ModuleSelect").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){this._createHeaderModel();var t=e.getParameter("arguments").orderId,r=e.getParameter("arguments").param2,t=t?this.handleRedirection(t,r):this.handleNormalFlow()},handleRedirection:function(e,t){this.handleSetLocalStaorage("OrderID",e);this.handleSetLocalStaorage("EquipmentNo",t);this.byId("idService").setSelectedKey("ZSSM");this.getServiceTypeDD()},handleNormalFlow:function(){var e=jQuery.sap.storage(jQuery.sap.storage.Type.local);var t=e.get("sMouleType");this.handleSetLocalStaorage("OrderID","");this.handleSetLocalStaorage("EquipmentNo","");this.byId("idService").setSelectedKey(t);this.getServiceTypeDD()},_createHeaderModel:function(){this.getModel().setData({busy:false,ModuleSearch:{Header:{},SelectServiceType:[],SelectSubServiceType:[]}})},getServiceTypeDD:function(){var e=[{path:"ProductType",value:this.byId("idService").getSelectedKey(),group:"ServiceTypeFilter"}];var t=[{sPath:"ProductGroup",bDescending:false}];var r=this.getFilters(e);this.getModel().setProperty("/busy",true);this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_COMMON_SRV"),"GET","/ZCDSV_PRODUCTTYPEVH/",null,r.ServiceTypeFilter,null,t).then(function(e){this.getModel().setProperty("/ModuleSearch/SelectServiceType/",e.results);this.getModel().setProperty("/busy",false)}.bind(this)).catch(function(e){this._handleError(e);this.getModel().setProperty("/busy",false)}.bind(this))},onSelectServiceTypeDD:function(){var e=[{path:"ProductGroup",value:this.getModel().getProperty("/ModuleSearch/Header/ServiceTypeKey/"),group:"ServiceTypeFilter"}];var t=[{sPath:"Product",bDescending:false}];var r=this.getFilters(e);this.getModel().setProperty("/busy",true);this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_COMMON_SRV"),"GET","/ZCDSV_SUBSERVICEVH/",null,r.ServiceTypeFilter,null,t).then(function(e){this.getModel().setProperty("/ModuleSearch/SelectSubServiceType/",e.results);this.getModel().setProperty("/busy",false)}.bind(this)).catch(function(e){this._handleError(e);this.getModel().setProperty("/busy",false)}.bind(this))},handleBackPress:function(){var e,t;e=r.getInstance();t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getRouter().navTo("AppHomePage",{},true)}},handleBackHomePress:function(){this.getRouter().navTo("HomePage",{},true)},onSearch:function(){this.InputValidation()!==true?"":this.onNavigation()},onNavigation:function(){var e=this.getModel().getProperty("/ModuleSearch/Header/SUbServiceKey/");this.setDataLocalStaorage(e);this.getModel().setProperty("/ServiceProduct/",e);var t=this.byId("idService").getSelectedKey();var r=t==="ZSSH"?"HRCreateRequest":t==="ZSSI"?"ITCreateRequest":t==="ZSSF"?"FinanceCreateRequest":t==="ZSSS"?"SCMCreateRequest":t==="ZSSM"?"PMCreateServiceRequest":"";this.oRouter.navTo(r)},InputValidation:function(){var e=true;if(!this.getModel().getProperty("/ModuleSearch/Header/ServiceTypeKey/")){this.getModel().setProperty("/ModuleSearch/Header/ServiceTypeKey/","");e=false}if(!this.getModel().getProperty("/ModuleSearch/Header/SUbServiceKey/")){this.getModel().setProperty("/ModuleSearch/Header/SUbServiceKey/","");e=false}return e},setDataLocalStaorage:function(e){var t=jQuery.sap.storage(jQuery.sap.storage.Type.local);t.put("sSubServiceType",e)},onSelectSubServiceTypeDD:function(e){var t=e.getSource().getSelectedKey();var r=t.split("_")[2],r=r===""?"":r;this.getModel().setProperty("/ModuleSearch/Header/Desc/",r);this.getModel().setProperty("/ModuleSearch/Header/SLA/",t.split("_")[4]);this.getModel().setProperty("/ModuleSearch/Header/Price/",t.split("_")[5])}})});