sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/PDFViewer","sap/ui/Device","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/routing/History"],function(e,t,o,s,i,a,r,n){"use strict";return e.extend("com.swcc.Template.controller.SlaCreationView",{onInit:function(){this.oRouter=this.getRouter();this.getRouter().getRoute("SlaCreation").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(){this._SLARegistrationModel();this.getSLADetails()},_SLARegistrationModel:function(){this.getModel().setData({busy:false,SLACheckFlag:false,SLARegistrationData:{Header:{},CustomData:{}}})},getSLADetails:function(){var e=this.getCurrentUserLoggedIn();var t=`/BPRequestSet(UserName='${e}')`;this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_USER_SRV"),"GET",t).then(function(e){this.getModel().setProperty("/SLARegistrationData/Header/",e);this.getModel().setProperty("/busy",false)}.bind(this)).catch(function(e){this._handleError(e);this.getModel().setProperty("/busy",false)}.bind(this))},onCancel:function(){var e,t;e=n.getInstance();t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getRouter().navTo("HomePage",{},true)}},SubmitSLARegistration:function(e){var t=this.getModel().getProperty("/SLARegistrationData/Header/");e.P2_Customer=t?t.Company:"";e.UserName=this.getCurrentUserLoggedIn();this.getModel().setProperty("/busy",true);this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_USER_SRV"),"POST","/SLARequestSet",e).then(function(e){this._handleMessageBoxProceed(`SLA Request has been Created : ${e.ReqID} `);this.getModel().setProperty("/CustomerRegistrationData/Header/",null);this.getModel().setProperty("/busy",false)}.bind(this)).catch(function(e){this._handleError(e);this.getModel().setProperty("/busy",false)}.bind(this))},onProceed:function(){var e=this.getModel().getProperty("/SLARegistrationData/CustomData/");this.InputValidation()!==true?"":this.SubmitSLARegistration(e)},InputValidation:function(){var e=true;if(!this.getModel().getProperty("/SLARegistrationData/CustomData/P2_Represen/")){this.getModel().setProperty("/SLARegistrationData/CustomData/P2_Represen/","");e=false}if(!this.getModel().getProperty("/SLARegistrationData/CustomData/P2_Rep_Pos/")){this.getModel().setProperty("/SLARegistrationData/CustomData/P2_Rep_Pos/","");e=false}if(!this.getModel().getProperty("/SLARegistrationData/CustomData/P2_CorName/")){this.getModel().setProperty("/SLARegistrationData/CustomData/P2_CorName/","");e=false}if(!this.getModel().getProperty("/SLARegistrationData/CustomData/P2_CorPos/")){this.getModel().setProperty("/SLARegistrationData/CustomData/P2_CorPos/","");e=false}if(!this.getModel().getProperty("/SLARegistrationData/CustomData/P2_CorEmail/")){this.getModel().setProperty("/SLARegistrationData/CustomData/P2_CorEmail/","");e=false}if(!this.getView().byId("accept_checkbox").getSelected()){r.show("Please Accept SLA Version");e=false}return e},onSelectCheckagreement:function(e){if(this.getModel().getProperty("/SLACheckFlag/")){this.getView().byId("accept_checkbox").setSelected(false);r.show("Please Read SLA Version and Accept")}},onPresshomepage:function(){this.getOwnerComponent().getRouter().navTo("HomePage")},_handleMessageBoxProceed:function(e){var t=this;sap.m.MessageBox.success(e,{icon:a.Icon.SUCCESS,title:"Success",actions:[a.Action.OK],emphasizedAction:a.Action.YES,onClose:function(e){if(e=="OK"){t.onPresshomepage()}}})},onPressAgreement:function(){this.getModel().setProperty("/busy",true);var e=this.getOwnerComponent().getModel("ZSSP_USER_SRV").sServiceUrl;var t=this.getCurrentUserLoggedIn();var o=`/SLAPreviewSet(Username='${t}')/$value`;fetch(e+o).then(e=>e.blob()).then(e=>{const t=URL.createObjectURL(e);this.getModel().setProperty("/busy",false);this.getModel().setProperty("/pdf",t);this.oopenSLAAgreementDialog()}).catch(e=>{this.getModel().setProperty("/busy",false);console.error("Error fetching the PDF:",e)})},oopenSLAAgreementDialog:function(e){var t=this.getView();if(!this.oSearchResultDialog){o.load({id:t.getId(),name:"com.swcc.Template.fragments.PDFViewer",controller:this}).then(function(e){e.setTitle("SLA Agreement Version");this.oSearchResultDialog=e;this.getView().addDependent(e);e.attachAfterOpen(function(){var e=t.byId("myScrollContainer");var o=e.getDomRef();o.addEventListener("click",this.onScroll.bind(this))}.bind(this));e.open()}.bind(this))}else{this.oSearchResultDialog.open()}},loadPDFView:function(){var e=this.getView().byId("myHTMLControl");e.$().off("scroll");e.$().on("scroll",this.onScroll.bind(this))},onScroll:function(e){console.log("Scrolled")},onCloseSlaAgreementDialog:function(){this.oSearchResultDialog.close()},onacceptpdf:function(e){this.getModel().setProperty("/SLACheckFlag/",true);this.getView().byId("accept_checkbox").setSelected(true);this.onCloseSlaAgreementDialog()},onrejectpdf:function(e){this.getModel().setProperty("/SLACheckFlag/",false);this.getView().byId("accept_checkbox").setSelected(false);this.oSearchResultDialog.close()}})});