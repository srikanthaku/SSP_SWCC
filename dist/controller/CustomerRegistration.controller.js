sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/core/routing/History"],function(t,e,o,r){"use strict";return t.extend("com.swcc.Template.controller.CustomerRegistration",{onInit:function(){this.oRouter=this.getRouter();var t=sap.ui.core.UIComponent.getRouterFor(this);t.attachRouteMatched(function(t){var e=t.getParameter("name");if(e==="CustomerRegistration"){this.callDropDownAndModel()}},this)},callDropDownAndModel:function(){this._customeRegistrationModel();this.getModel().setSizeLimit(1e3);this.CountryF4()},_customeRegistrationModel:function(){this.getModel().setData({busy:false,ValidationFlag:false,CustomerRegistrationData:{UploadedData:[],Header:{},CountryF4:[],Attachments:[],RegionF4:[]}})},CountryF4:function(){var t=[{path:"Language",value:"EN",group:"CountryFilter"}];var e=this.getFilters(t);this.getModel().setProperty("/busy",true);this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_USER_SRV"),"GET","/A_CountryText/",null,e.CountryFilter).then(function(t){this.getModel().setProperty("/CustomerRegistrationData/CountryF4/",t.results);this.getModel().setProperty("/busy",false)}.bind(this)).catch(function(t){this._handleError(t);this.getModel().setProperty("/busy",false)}.bind(this))},onCountryChange:function(t){var e=t.getSource().getSelectedKey();var o=[{path:"Country",value:t.getSource().getSelectedKey(),group:"CountryChangeFilter",useOR:true},{path:"Language",value:"EN",group:"CountryChangeFilter"}];var r=this.getFilters(o);this.getModel().setProperty("/busy",true);this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_USER_SRV"),"GET","/C_RegionTextVHTemp",null,r.CountryChangeFilter).then(function(t){t.results.length===0?this.getModel().setProperty("/CustomerRegistrationData/Header/Regio/",null):this.getModel().setProperty("/CustomerRegistrationData/RegionF4/",t.results);this.getModel().setProperty("/CustomerRegistrationData/RegionF4/",t.results);this.getModel().setProperty("/busy",false)}.bind(this)).catch(function(t){this._handleError(t);this.getModel().setProperty("/busy",false)}.bind(this))},onSubmitBP:function(){var t=this.getModel().getProperty("/CustomerRegistrationData/Header/");this.InputValidation()!==true?"":this.SubmitBPRegistration(t)},InputValidation:function(){var t=true;if(!this.getModel().getProperty("/CustomerRegistrationData/Header/Company/")){this.getModel().setProperty("/CustomerRegistrationData/Header/Company/","");this.getModel().setProperty("/ValidationFlag/",true);t=false}if(!this.getModel().getProperty("/CustomerRegistrationData/Header/Stras/")){this.getModel().setProperty("/CustomerRegistrationData/Header/Stras/","");this.getModel().setProperty("/ValidationFlag/",true);t=false}if(!this.getModel().getProperty("/CustomerRegistrationData/Header/Pstlz/")){this.getModel().setProperty("/CustomerRegistrationData/Header/Pstlz/","");this.getModel().setProperty("/ValidationFlag/",true);t=false}if(!this.getModel().getProperty("/CustomerRegistrationData/Header/Land1/")){this.getModel().setProperty("/CustomerRegistrationData/Header/Land1/","");this.getModel().setProperty("/ValidationFlag/",true);t=false}if(!this.getModel().getProperty("/CustomerRegistrationData/Header/Land1/")){this.getModel().setProperty("/CustomerRegistrationData/Header/Land1/","");this.getModel().setProperty("/ValidationFlag/",true);t=false}if(!this.getModel().getProperty("/CustomerRegistrationData/Header/Regio/")){this.getModel().setProperty("/CustomerRegistrationData/Header/Regio/","");this.getModel().setProperty("/ValidationFlag/",true);t=false}if(!this.getModel().getProperty("/CustomerRegistrationData/Header/Regio/")){this.getModel().setProperty("/CustomerRegistrationData/Header/Regio/","");this.getModel().setProperty("/ValidationFlag/",true);t=false}if(!this.getModel().getProperty("/CustomerRegistrationData/Header/Email/")){this.getModel().setProperty("/CustomerRegistrationData/Header/Email/","");this.getModel().setProperty("/ValidationFlag/",true);t=false}if(!this.getModel().getProperty("/CustomerRegistrationData/Header/Cr_No/")){this.getModel().setProperty("/CustomerRegistrationData/Header/Cr_No/","");this.getModel().setProperty("/ValidationFlag/",true);t=false}if(!this.getModel().getProperty("/CustomerRegistrationData/Header/PhoneNo/")){this.getModel().setProperty("/CustomerRegistrationData/Header/PhoneNo/","");this.getModel().setProperty("/ValidationFlag/",true);t=false}else{this.getModel().setProperty("/ValidationFlag/",false)}return t},onCancel:function(){var t,e;t=r.getInstance();e=t.getPreviousHash();if(e!==undefined){window.history.go(-1)}else{this.getRouter().navTo("HomePage",{},true)}},SubmitBPRegistration:function(t){var t=this.getModel().getProperty("/CustomerRegistrationData/Header/");t.UserName=this.getCurrentUserLoggedIn();const e=this.getModel().getProperty("/CustomerRegistrationData/UploadedData").map(({Filesize:t,...e})=>e);t.Attachments=e;this.getModel().setProperty("/busy",true);this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_USER_SRV"),"POST","/BPRequestSet",t,null,null).then(function(t){this._handleMessageBoxProceed(`Service Request has been created : ${t.ReqID} `);this.getModel().setProperty("/CustomerRegistrationData/Header/",null);this.getModel().setProperty("/busy",false)}.bind(this)).catch(function(t){this._handleError(t);this.getModel().setProperty("/busy",false)}.bind(this))},_handleMessageBoxProceed:function(t){var e={sMessage:t};this.createMessageBoxHandler(this.onPresshomepage.bind(this))(e)},onPresshomepage:function(){this.getOwnerComponent().getRouter().navTo("HomePage")},onback:function(){},onAddItemsPress:function(t){var e=this.getModel().getProperty("/MarineTransportation/itemData");var o=e.map(function(t){return Object.assign({},t)});o.push({Material:"",Description:"",StorageLocation:"",Quantity:"",BaseUnit:"",Batch:"",M:true,AvailableQty:null,PopupItems:null,IsBOQApplicable:""});this.getModel().setProperty("/MarineTransportation/itemData",o)},onDeleteItemPress:function(t){var e=parseInt(t.getSource().getBindingContext().getPath().split("/")[3]);var o=this.getModel().getProperty("/MarineTransportation/itemData");o.splice(e,1);this.getModel().refresh()},onFileAdded:function(t){var e=this;var o=t.getSource();var r=t.getParameter("files");if(r.length===0)return;var a=r[0].name,i=r[0].type,s=r[0],n=r[0].size;this._getImageData(s,function(t){e._addData(t,a,i,n)})},_addData:function(t,e,o,r){var a=this.getModel().getProperty("/CustomerRegistrationData/UploadedData");var i=a.map(function(t){return Object.assign({},t)});i.push({Filename:e,Mimetype:o,Value:t});this.getModel().setProperty("/CustomerRegistrationData/UploadedData",i)},handleMissmatch:function(){this.handleFileMissmatch()},onFileSizeExceed:function(){this.handleFileSizeExceed()},onSubmit:function(){this.getOwnerComponent().getRouter().navTo("SlaCreation")}})});