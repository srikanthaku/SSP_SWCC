sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/routing/History","sap/m/MessageBox"],function(e,t,s,r,a,o){"use strict";return e.extend("com.swcc.Template.controller.UserManagementRequest",{onInit:function(){this.oRouter=this.getRouter();this.getRouter().getRoute("UserManagementRequest").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(){this._createItemDataModel();this.getPendingUserDetails();this.getApprovedUserDetails()},_createItemDataModel:function(){this.getModel().setData({busy:false,OpenItemRequestData:{itemData:[]},ClosedItemRequestData:{itemData:[]}})},onFilterBarSearch:function(e){debugger;var t=this.getView().byId("idAvailableUsers");var s=this.getView().byId("idPendingUserTable");var r=e.getParameter("selectionSet");var a=[{path:"RequestID",value:r[0].getValue(),group:"DynamicF4SearchFilter",useOR:true},{path:"FirstName",value:r[1].getValue(),operator:sap.ui.model.FilterOperator.Contains,group:"DynamicF4SearchFilter",useOR:true},{path:"LastName",value:r[2]&&r[2].getValue()?r[2].getValue().split("-")[0]:"",operator:sap.ui.model.FilterOperator.Contains,group:"DynamicF4SearchFilter",useOR:true},{path:"Email",value:r[3]&&r[3].getValue()?r[3].getValue():"",group:"DynamicF4SearchFilter"}];var o=this.getFilters(a);this._filterTable(o.DynamicF4SearchFilter,"Application",[t,s])},_filterTable:function(e,t,s){this.handleVHFilterTable(e,t,s)},getPendingUserDetails:function(){var e=[{path:"ID",value:this.getCurrentUserLoggedIn(),group:"UserFilter"}];var t=this.getFilters(e);this.getModel().setProperty("/busy",true);this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_USER_SRV"),"GET","/UserRequestSet",null,t.UserFilter,null).then(function(e){this.getModel().setProperty("/busy",false);this.getModel().setProperty("/OpenItemRequestData/itemData",e.results)}.bind(this)).catch(function(e){this._handleError(e);this.getModel().setProperty("/busy",false);this.getModel().setProperty("/busy",false)}.bind(this))},getApprovedUserDetails:function(){var e=[{path:"SapID",value:this.getCurrentUserLoggedIn(),group:"UserFilter"}];var t=this.getFilters(e);this.getModel().setProperty("/busy",true);this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_USER_SRV"),"GET","/UserSet",null,t.UserFilter,null).then(function(e){this.getModel().setProperty("/busy",false);var t=this.insertcustomProperties(e);this.getModel().setProperty("/ClosedItemRequestData/itemData",t)}.bind(this)).catch(function(e){this._handleError(e);this.getModel().setProperty("/busy",false)}.bind(this))},insertcustomProperties:function(e){const t=e.results.map(e=>({...e,editFlag:false}));return t},onApprove:function(e){var t=e.getSource().getBindingContext().getObject().ID;var s={sRequestID:t,sBtnTxt:"Approve",sMsgTxt:`Are you sure you want to Approve the Request: ${t} `};this.handleConfirmMessage(this.onApproveAPICall.bind(this))(s)},onApproveAPICall:function(e){var t={RequestID:e};this.getModel().setProperty("/busy",true);this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_USER_SRV"),"POST","/UserSet",t,null,null).then(function(e){this.getModel().setProperty("/busy",false);this._handleMessageBoxProceed(`Request has been Approved Successfully `)}.bind(this)).catch(function(e){this._handleError(e);this.getModel().setProperty("/busy",false)}.bind(this))},_handleMessageBoxProceed:function(e){var t={sMessage:e};this.createMessageBoxHandler(this._onObjectMatched.bind(this))(t)},onReject:function(e){var t=e.getSource().getBindingContext().getObject().ID;var s={sRequestID:t,sMsgTxt:`Are you sure you want to Reject the Request: ${t} `,sBtnTxt:"Reject"};this.handleConfirmMessage(this.onRejectAPICall.bind(this))(s)},onRejectAPICall:function(e){var t=`/UserRequestSet(ID='${e}')`;this.getModel().setProperty("/busy",true);this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_USER_SRV"),"DELETE",t,null,null,null).then(function(e){this.getModel().setProperty("/busy",false);this._handleMessageBoxProceed(`Request has been Rejected Successfully `)}.bind(this)).catch(function(e){this._handleError(e);this.getModel().setProperty("/busy",false)}.bind(this))},handleBackPress:function(){var e,t;e=a.getInstance();t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getRouter().navTo("HomePage",{},true)}},onSelectRole:function(e){debugger;var t=parseInt(e.getSource().getBindingContext().getPath().split("/")[3]);var s=e.getSource().getText();s=s==="HR"?"AccessHR":s;s=s==="FI"?"AccessFI":s;s=s==="IT"?"AccessIT":s;s=s==="TECH"?"AccessPM":s;s=s==="SCM"?"AccessSC":s;var r=s;if(e.getSource().getSelected()){this.getModel().setProperty(`/ClosedItemRequestData/itemData/${t}/${s}/`,"X")}else{this.getModel().setProperty(`/ClosedItemRequestData/itemData/${t}/${s}/`,"")}},onEditUSer:function(e){var t=parseInt(e.getSource().getBindingContext().getPath().split("/")[3]);this.getModel().setProperty(`/ClosedItemRequestData/itemData/${t}/editFlag/`,true)},onSaveUser:function(e){var t=e.getSource().getBindingContext().getObject();const{editFlag:s,...r}=t;this.callSaveUSerAPI(r)},callSaveUSerAPI:function(e){var t=`/UserSet(RequestID='',SapID='${e.SapID}')`;this.getModel().setProperty("/busy",true);this.getAPI.oDataACRUDAPICall(this.getOwnerComponent().getModel("ZSSP_USER_SRV"),"PUT",t,e,null,null).then(function(e){if(e===undefined){conole.log("dswdwsd")}debugger;this._handleMessageBoxProceed(`Service Request has been created : ${e.ReqID} `);this._onObjectMatched();this.getModel().setProperty("/busy",false)}.bind(this)).catch(function(e){this._onObjectMatched();this.getModel().setProperty("/busy",false)}.bind(this))},onCancelUser:function(){this._onObjectMatched()},onPressTile:function(e){this.getOwnerComponent().getRouter().navTo("ModuleSelect")}})});